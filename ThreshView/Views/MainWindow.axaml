<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ThreshView.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:u="https://irihi.tech/ursa"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
        x:Class="ThreshView.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="ThreshView">

    <Window.Resources>
    </Window.Resources>

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="*" ColumnDefinitions="200,*,320" Margin="8">
        <!-- Left: Thumbnails -->
        <HeaderedContentControl Grid.Row="0" Grid.Column="0"  Theme="{DynamicResource GroupBox}">
            <HeaderedContentControl.Header>
                <StackPanel Orientation="Horizontal" Margin="-6" VerticalAlignment="Stretch">
                <TextBlock VerticalAlignment="Center" Text="Images" FontWeight="Bold" />
                <Button VerticalAlignment="Center" Margin="20,0,0,0" Content="Open..." Command="{Binding OpenCommand}" />
                </StackPanel>
            </HeaderedContentControl.Header>
            <ScrollViewer>
                <ListBox ItemsSource="{Binding OpenImages}" SelectedItem="{Binding SelectedImage, Mode=TwoWay}">
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="vm:ImageDocumentViewModel">
                                <StackPanel Orientation="Vertical">
                                    <Image Source="{Binding ThresholdedPreview}" Width="160" Height="120"
                                           Stretch="Uniform" />
                                    <TextBlock Text="{Binding FileName}" TextWrapping="Wrap" MaxWidth="160" />
                                </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </ScrollViewer>
        <!-- </Border> -->

        </HeaderedContentControl>

        <u:ImageViewer Grid.Row="0" Grid.Column="1" Margin="4,0,4,0" Source="{Binding SelectedImage.ThresholdedPreview}" Stretch="Uniform" />

        <!-- Right: Threshold preview + controls -->
        <HeaderedContentControl Grid.Row="0" Grid.Column="2" Padding="8" Theme="{DynamicResource GroupBox}">
            <StackPanel>
                <StackPanel Orientation="Vertical" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="4">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Margin="0,0,5,0" Text="Threshold:" VerticalAlignment="Center" FontWeight="Bold"/>
                        <Border Theme="{DynamicResource RadioButtonGroupBorder}">
                            <StackPanel Orientation="Horizontal">
                                <RadioButton Theme="{DynamicResource ButtonRadioButton}"
                                             GroupName="ThresholdDirection"
                                             IsChecked="{Binding ThresholdMoreThen, Mode=TwoWay}"
                                             FontSize="12" FontWeight="Bold">
                                    &lt;
                                </RadioButton>
                                <RadioButton Theme="{DynamicResource ButtonRadioButton}"
                                             GroupName="ThresholdDirection"
                                             IsChecked="{Binding !ThresholdMoreThen, Mode=TwoWay}" FontSize="12" FontWeight="Bold">
                                    &gt;
                                </RadioButton>
                                </StackPanel>
                        </Border>
                        <TextBox Width="48" Text="{Binding Threshold, Mode=TwoWay}" Margin="6,0,0,0" />
                    </StackPanel> 
                    <Slider HorizontalAlignment="Stretch" Margin="6" Minimum="0" Maximum="255" Value="{Binding Threshold, Mode=TwoWay}"/>
                </StackPanel>
                <Separator/>
                <TextBlock Text="Overlay Color" FontWeight="Bold" Margin="4,8,4,0" />
                <ColorView Color="{Binding ThresholdColor}" Palette="{Binding ColorPalette}" />
                <Separator Margin="6"/>
                <Button HorizontalAlignment="Stretch" Content="Save Mask" Command="{Binding SaveMask}"/>
                <Button HorizontalAlignment="Stretch" Margin="0,2,0,0" Content="Save Overlay Images" Command="{Binding SaveOverlay}"/>
                
            </StackPanel>
        </HeaderedContentControl>
    </Grid>

</Window>