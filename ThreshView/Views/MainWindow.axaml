<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ThreshView.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:conv="using:ThreshView.Views.Converters"
        mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
        x:Class="ThreshView.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="ThreshView">

    <Window.Resources>
        <conv:OverlayColorConverter x:Key="OverlayColorConverter"/>
    </Window.Resources>

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*" ColumnDefinitions="200,*,320" Margin="8">
        <StackPanel Orientation="Horizontal" Grid.ColumnSpan="3" HorizontalAlignment="Right">
            <Button Content="Open..." Command="{Binding OpenCommand}" Margin="4"/>
        </StackPanel>

        <!-- Left: Thumbnails -->
        <Border Grid.Row="1" Grid.Column="0" BorderBrush="Gray" BorderThickness="1" Padding="4">
            <ScrollViewer>
                <ListBox ItemsSource="{Binding OpenImages}" SelectedItem="{Binding SelectedImage, Mode=TwoWay}">
                    <ListBox.ItemTemplate>
                        <DataTemplate DataType="vm:ImageDocumentViewModel">
                            <Border Padding="4" Margin="2" BorderBrush="LightGray" BorderThickness="1">
                                <StackPanel Orientation="Vertical">
                                    <Image Source="{Binding Thumbnail}" Width="160" Height="120" Stretch="Uniform"/>
                                    <TextBlock Text="{Binding FileName}" TextWrapping="Wrap" MaxWidth="160"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </ScrollViewer>
        </Border>


        <Image Grid.Row="1" Grid.Column="1" Source="{Binding SelectedImage.ThresholdedPreview}" Stretch="Uniform"  />

        <!-- Right: Threshold preview + controls -->
        <Border Grid.Row="1" Grid.Column="2" BorderBrush="Gray" BorderThickness="1" Padding="8">
            <StackPanel>
                <StackPanel Orientation="Vertical" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="4">
                    <TextBlock Text="Threshold:" VerticalAlignment="Center" Margin="4"/>
                    <Slider Minimum="0" Maximum="255" Width="200" Value="{Binding SelectedImage.Threshold, Mode=TwoWay}"/>
                    <TextBox Width="48" Text="{Binding SelectedImage.Threshold, Mode=TwoWay}" Margin="6,0,0,0"/>
                </StackPanel>

                <TextBlock Text="Overlay Color" FontWeight="Bold" Margin="4,8,4,0"/>
                <StackPanel Orientation="Vertical" Margin="4">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="R"/>
                        <Slider Minimum="0" Maximum="255" Width="180" Value="{Binding SelectedImage.OverlayR, Mode=TwoWay}"/>
                    </StackPanel>
                    <StackPanel  Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="G"/>
                        <Slider Minimum="0" Maximum="255" Width="180" Value="{Binding SelectedImage.OverlayG, Mode=TwoWay}"/>
                    </StackPanel>
                    <StackPanel  Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="B"/>
                        <Slider Minimum="0" Maximum="255" Width="180" Value="{Binding SelectedImage.OverlayB, Mode=TwoWay}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Alpha"/>
                        <Slider Minimum="0" Maximum="255" Width="180" Value="{Binding SelectedImage.OverlayA, Mode=TwoWay}"/>
                    </StackPanel>
                </StackPanel>

                <Border BorderBrush="Black" BorderThickness="1" Height="24" Margin="4">
                    <Rectangle Fill="{Binding SelectedImage, Converter={StaticResource OverlayColorConverter}}"/>
                </Border>
            </StackPanel>
        </Border>
    </Grid>

</Window>
